
The Problems:

1. Parcel bundler bug with Electron: When Parcel bundles asset imports (like images and HTML files) for electron-main context, it replaces them with empty objects {} instead of the actual file paths. This is a known issue with Parcel + Electron.
2. WebSocket bug in the source code (socket.ts:17): The code was using ws.emit('n:comment', comment) instead of ws.send(comment). The emit() method is for internal EventEmitter events, not for sending WebSocket messages to clients. So messages were logged to console but never sent to the overlay window.
3. File path library incompatibility: The original code used file-uri-to-path library which expects file:// URIs, but Parcel was outputting regular relative paths, causing crashes on Windows.

The Fixes:

1. Changed asset handling in tray.ts and window.ts: Replaced uriToPath(iconUri) with path.join(__dirname, iconUri) and used pathToFileURL() for the content window URL.
2. Fixed WebSocket broadcasting in socket.ts: Changed ws.emit('n:comment', comment) to client.send(comment) so messages actually reach the overlay.
3. Manually patched the compiled output: Since Parcel still outputs {} for asset paths, I edited dist/app/index.js to hardcode the correct filenames (icon_16x16.e7d307e5.png and content.ea1736f1.html).

Was it Windows-incompatible?

Not exactly. The project would work on any OS, but:
- The Parcel bundling issue affects all platforms
- The WebSocket bug affected all platforms
- The file-uri-to-path issue was slightly worse on Windows due to path format differences

Note: After rebuilding with pnpm run build, you'll need to manually edit dist/app/index.js again to fix the asset paths (steps 3), unless the Parcel bundler is fixed upstream.


```ps1
z 'C:\Utilities\@Playground\niconizer'
pnpm run build
pnpm start
```
