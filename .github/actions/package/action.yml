name: Package

description: packaging

runs:
  using: composite
  steps:
    - uses: actions/checkout@3df4ab11eba7bda6032a0b82a6bb43b11571feac # v4
    - uses: actions/setup-node@v3
      with:
        node-version-file: .node-version
        cache: "npm"

    - shell: bash
      run: npm ci

    - shell: bash
      run: npm test

    - shell: bash
      run: npm run build

    - name: install apt packages
      shell: bash
      run: |
        sudo apt update
        sudo apt install -y wine convmv

    - uses: nick-fields/retry@v2
      with:
        timeout_minutes: 10
        max_attempts: 5
        command: npm run package
